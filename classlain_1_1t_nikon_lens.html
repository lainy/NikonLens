<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>NikonLens: lain::tNikonLens Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NikonLens
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Library for controlling Nikon F-mount lenses.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>lain</b></li><li class="navelem"><a class="el" href="classlain_1_1t_nikon_lens.html">tNikonLens</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classlain_1_1t_nikon_lens-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">lain::tNikonLens Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Control Nikon F-mount lenses from an Arduino.  
 <a href="classlain_1_1t_nikon_lens.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_nikon_lens_8h_source.html">NikonLens.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:aa7176efbabf3fc17176cdcd695ccea3e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa7176efbabf3fc17176cdcd695ccea3e"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlain_1_1t_nikon_lens.html#aa7176efbabf3fc17176cdcd695ccea3e">tResultCode</a> { <b>Success</b>, 
<b>Timeout</b>
 }</td></tr>
<tr class="memdesc:aa7176efbabf3fc17176cdcd695ccea3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Possible result codes for commands. <br /></td></tr>
<tr class="separator:aa7176efbabf3fc17176cdcd695ccea3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2c3cb286c7786dc01d7cf560e19b94e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlain_1_1t_nikon_lens.html#a2c3cb286c7786dc01d7cf560e19b94e5">begin</a> (<a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> handshakePin_In, <a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> handshakePin_Out)</td></tr>
<tr class="memdesc:a2c3cb286c7786dc01d7cf560e19b94e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize SPI for lens communication.  <a href="#a2c3cb286c7786dc01d7cf560e19b94e5">More...</a><br /></td></tr>
<tr class="separator:a2c3cb286c7786dc01d7cf560e19b94e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fb0d6d2b8dca226883d218c25a556a4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9fb0d6d2b8dca226883d218c25a556a4"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlain_1_1t_nikon_lens.html#a9fb0d6d2b8dca226883d218c25a556a4">end</a> ()</td></tr>
<tr class="memdesc:a9fb0d6d2b8dca226883d218c25a556a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tear down, relinquish resources. <br /></td></tr>
<tr class="separator:a9fb0d6d2b8dca226883d218c25a556a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae251ace704b84cd7bce5e3d2ef2d11a8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classlain_1_1t_nikon_lens.html#aa7176efbabf3fc17176cdcd695ccea3e">tResultCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlain_1_1t_nikon_lens.html#ae251ace704b84cd7bce5e3d2ef2d11a8">sendCommand</a> (<a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> cmd, <a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> byteCountFromLens=0, <a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> *bytesFromLens=nullptr, <a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> byteCountToLens=0, <a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> const *bytesToLens=nullptr)</td></tr>
<tr class="memdesc:ae251ace704b84cd7bce5e3d2ef2d11a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send lens command and read/write data.  <a href="#ae251ace704b84cd7bce5e3d2ef2d11a8">More...</a><br /></td></tr>
<tr class="separator:ae251ace704b84cd7bce5e3d2ef2d11a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Control Nikon F-mount lenses from an Arduino. </p>
<p>Nikon lenses use a modified version of SPI. See also:</p><ul>
<li>Protocol: <a href="http://nikonhacker.com/wiki/Lens_Serial_Interface">http://nikonhacker.com/wiki/Lens_Serial_Interface</a></li>
<li>Pinout: <a href="http://nikonhacker.com/wiki/F-Mount">http://nikonhacker.com/wiki/F-Mount</a></li>
<li>Arduino SPI: <a href="http://arduino.cc/en/Reference/SPI">http://arduino.cc/en/Reference/SPI</a></li>
</ul>
<p>Connections are as follows (with Arduino Uno pin numbers):</p><ul>
<li>SS (10) is unused.</li>
<li>SCK (13) is connected directly to lens SCLK.</li>
<li>MISO (12) is connected to the lens Data line, which must be pulled high.</li>
<li>MOSI (11) drives the lens Data line through a transistor, open-collector.<br />
 So: MOSI -&gt; Base, Data -&gt; Collector, GND -&gt; Emitter</li>
<li>handshakePin_In is connected directly to lens H/S</li>
<li>handshakePin_Out drives lens H/S through a transistor, open-collector.</li>
</ul>
<p>NOTE: The Nikon D5100 starts communication with the lens at 96kHz, then increases speed to 156kHz if the lens supports it. Because the Arduino runs at 16MHz and the maximum divider ratio for SPI is 128, the slowest we can run the bus is 125kHz.<br />
 If using this code with older lenses causes problems, it should be modified to use the AVR's System Clock Prescaler to drop the CPU frequency so you can achieve a slower SPI bus speed.<br />
 I haven't tested this, it may interfere with other Arduino features. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a2c3cb286c7786dc01d7cf560e19b94e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lain::tNikonLens::begin </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a>&#160;</td>
          <td class="paramname"><em>handshakePin_In</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a>&#160;</td>
          <td class="paramname"><em>handshakePin_Out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize SPI for lens communication. </p>
<p>See class description for connection information. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">handshakePin_In</td><td>Input pin for reading the H/S line. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">handshakePin_Out</td><td>Output pin for pulling the H/S line low. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae251ace704b84cd7bce5e3d2ef2d11a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classlain_1_1t_nikon_lens.html#aa7176efbabf3fc17176cdcd695ccea3e">tNikonLens::tResultCode</a> lain::tNikonLens::sendCommand </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a>&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a>&#160;</td>
          <td class="paramname"><em>byteCountFromLens</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> *&#160;</td>
          <td class="paramname"><em>bytesFromLens</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a>&#160;</td>
          <td class="paramname"><em>byteCountToLens</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__util.html#ga92c50087ca0e64fa93fc59402c55f8ca">u8</a> const *&#160;</td>
          <td class="paramname"><em>bytesToLens</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send lens command and read/write data. </p>
<p>Sends command <em>cmd</em> to the lens.<br />
If data is to be received, <em>byteCountFromLens</em> must be set to the number of bytes expected.<br />
 If data is to be sent, <em>byteCountToLens</em> must be set to the number of bytes to send.<br />
Received data is placed in <em>bytesFromLens</em>, so it must be sized accordingly.<br />
 Likewise, data sent to the lens is sourced from <em>bytesToLens</em>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cmd</td><td>The command byte to send. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">byteCountFromLens</td><td>Number of bytes to receive, or zero if not receiving. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">bytesFromLens</td><td>Destination for received bytes, or null if not receiving. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">byteCountToLens</td><td>Number of bytes to send, or zero if not sending. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bytesToLens</td><td>Source of bytes sent to lens, or null if not sending. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A result code indicating success, or the failure cause. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_nikon_lens_8h_source.html">NikonLens.h</a></li>
<li>NikonLens.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 6 2014 18:27:19 for NikonLens by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
